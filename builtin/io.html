<p class="hidden" id="builtin-title">halo:io</p>

<style>
#io-content p {
    padding: 0;
    margin: 0;
    line-height: 26px;
}
#io-content textarea {
    width: 220px;
    height: 340px;
    border: 1px solid #aaa;
    padding: 10px;
    font: 16px/24px PTSerif;
}
#io-content h2 {
    font: 18px/22px PTSerif;
    margin: 10px 0 10px 0;
}
#io-content #import {
    float: left;
    padding: 0 30px;
    border-right: 1px dashed #eee;
}
#io-content #export {
    float: left;
    padding: 0 30px;
}
#io-content button, #io-content select {
    margin: 7px 0 30px 0;
}
</style>
<script>
$(document).ready(function() {
    get_wordlist(export_wordlist);
    $("#export .separate-method").change(function() {
        get_wordlist(export_wordlist);
    });

    $("#import .import").click(function() {
        var separator = $("#import .separate-method").val();
        if (separator == "line") {
            separator = /[\n\r]+/;
        }
        else if (separator == "comma") {
            separator = ",";
        }
        else if (separator == "space") {
            separator = /\s+/;
        }

        var text = $("#import textarea").val();
        
        var list = text.split(separator);
        var list_final = [];
        for (var li in list) {
            var word = $.trim(list[li]);
            if (word) {
                list_final.push(word);
            }
        }
        storage_words(list_final.reverse());
        
        init_wordlist();
    });

    $("#import .reset").click(function() {
        if (confirm("注意：将清空单词表并恢复默认的单词，确定继续吗？")) {
            remove_all_word();
            storage_words(default_words.reverse());
            init_wordlist();
        }
    });
});

function export_wordlist(result) {
    var list = "";

    var separator = $("#export .separate-method").val();
    if (separator == "line") {
        separator = "\n";
    }
    else if (separator == "comma") {
        separator = ", ";
    }
    else if (separator == "space") {
        separator = " ";
    }

    for (var i = result.rows.length - 1; i >= 0; i--) {
        list += result.rows.item(i)['word'];
        if (i > 0) {
            list += separator;
        }
    }
    $("#export textarea").val(list);
}
</script>
<div id="io-content">

    <div id="import">
        <h2>Import Word List</h2>
        <p><textarea></textarea></p>
        <p>
            <select class="separate-method">
                <option value="line">每词一行</option>
                <option value="comma">逗号分隔</option>
                <option value="space">空格分隔</option>
            </select>
            <button class="import">导入</button>
            <button class="reset">重置</button>
        </p>
    </div>

    <div id="export">
        <h2>Export Word List</h2>
        <p><textarea readonly></textarea></p>
        <p>
            <select class="separate-method">
                <option value="line">每词一行</option>
                <option value="comma">逗号分隔</option>
                <option value="space">空格分隔</option>
            </select>
        </p>
    </div>

</div>